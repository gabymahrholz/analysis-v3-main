{
  "hash": "278e745bb6163654fb89bdc0920767f9",
  "result": {
    "markdown": "# Data viz I {#sec-dataviz}\n\n\n\n\n\n## Intended Learning Outcomes {.unnumbered}\n\nBy the end of this chapter you should be able to:\n\n-   explain the layered grammar of graphics\n-   choose an appropriate plot for categorical variables\n-   create a basic version of an appropriate plot\n-   apply extra layers to change the appearance of the plot\n\n## [Individual Walkthrough]{style=\"color: #F39C12; text-transform: uppercase;\"} {.unnumbered}\n\n## Building plots\n\nWe are using the package `ggplot2` to create data visualisations. It's part of the tidyverse package. Actually, most people call th package `ggplot` but it's official name is `ggplot2`.\n\n::: grid\n::: g-col-5\n**ggplot2** uses a layered grammar of graphics, in which plots are built up in a series of layers. You would start with a base layer (opening ggplot), adding **data** and **aesthetics**, and selecting the **geometries** for plot.\n\nThese first 3 layers will give you the most simple version of a complete plot, but you could add other layers to make the plots pretty by using **scales**, **facets**, **coordinates**, **labels** and **themes**.\n:::\n\n::: g-col-7\n![gg layers [(Presentation by Ryan Safner)](https://metricsf20.classes.ryansafner.com/slides/1.3-slides#20){target=\"_blank\"}](images/gglayers.png){width=\"70%\"}\n:::\n:::\n\nTo give you a brief overview of the layering system, let's use the package `palmerpenguins` ([https://allisonhorst.github.io/palmerpenguins/](https://allisonhorst.github.io/palmerpenguins/){target=\"_blank\"}). It contains data about bill length and depth, flipper length, and body mass, etc.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhead(penguins)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|species |island    | bill_length_mm| bill_depth_mm| flipper_length_mm| body_mass_g|sex    | year|\n|:-------|:---------|--------------:|-------------:|-----------------:|-----------:|:------|----:|\n|Adelie  |Torgersen |           39.1|          18.7|               181|        3750|male   | 2007|\n|Adelie  |Torgersen |           39.5|          17.4|               186|        3800|female | 2007|\n|Adelie  |Torgersen |           40.3|          18.0|               195|        3250|female | 2007|\n|Adelie  |Torgersen |             NA|            NA|                NA|          NA|NA     | 2007|\n|Adelie  |Torgersen |           36.7|          19.3|               193|        3450|female | 2007|\n|Adelie  |Torgersen |           39.3|          20.6|               190|        3650|male   | 2007|\n\n</div>\n:::\n:::\n\n\nLet's build a basic scatterplot to show the relationship between `flipper_length` and `body_mass`. We will customise plots further later on in the individual plots. This is just a quick overview of the different layers.\n\n-   Layer 1 creates a plot base to built up upon.\n-   Layer 2 adds the `data` and some `aesthetics`\n    -   data is first argument\n    -   aesthetics are added via the mapping argument. There you define your variables to be added (such as x, or x and y) and allows you specify overall properties like the colour of grouping variables etc.\n-   Layer 3 adds the geometries or `geom_?` for short. This tells ggplot in which style we want to plot the data points. Remember to add these layers with a `+` rather than a pipe `%>%`. You can add multiple geoms if you wish, e.g., building a violin-boxplot\n-   Layer 4 adds the `scale_?` functions which can help you customise the aesthetics, such as changing colour. You can do much more with scales, but we'll get to that later.\n-   Layer 5 introduces `facets`, such as `facet_wrap()` which allows you to add another dimension to the data output by showing the relationship you are interested in for each level of a categorical variable.\n-   Layer 6 - coordinates: `coord_cartesian()` controls the limits for the x- and y-axes (arguments `xlim` and `ylim`). Changing those allows you to zoom in or out of your plot.\n-   Layer 7 helps you to modify axes labels.\n-   Layer 8 controls the general style of a ggplot (e.g., background colour, size of text, borders, etc.). R comes with a few pre-defined ones (like `theme_classic`, `theme_bw`, `theme_minimal`, `theme_light`).\n\nClick on the tabs below to see how each layer contributes to refining the plot.\n\n::: {.panel-tabset}\n## Layer 1\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot()\n```\n\n::: {.cell-output-display}\n![](04-dataviz_files/figure-html/unnamed-chunk-3-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\nWe don't see much here. It's basically an empty plot layer.\n\n## Layer 2\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data = penguins, mapping = aes(x=body_mass_g, y=flipper_length_mm))\n```\n\n::: {.cell-output-display}\n![](04-dataviz_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\nYou won't see any data points yet, because we haven't specified how we want to display the data points. But we mapped in the aesthetics, that we want to plot variable body mass on the x-axis and flipper length on the y-axis. This also adds the axes titles and the values and break points of the axes.\n\n::: callout-tip\nYou won't need to add `data =` or `mapping =` if you keep those arguments in exactly that order. Likewise, the first column name you enter within the `aes()` function will always be interpreted as x, and the second as y, so you could omit them if you wish.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(penguins, aes(body_mass_g, flipper_length_mm))\n```\n:::\n\n\nwill give you the same output as the code above.\n:::\n\n## Layer 3\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data = penguins, mapping = aes(x=body_mass_g, y=flipper_length_mm, colour=sex)) +\n  geom_point()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](04-dataviz_files/figure-html/unnamed-chunk-6-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\nHere we are telling ggplot that we want a scatterplot added. There is a warning displayed showing that rows were removed because of missing values.\n\nThe argument `colour` adds colour to the points according to a grouping variable (in this case sex). If you want all of the points to be black (i.e. only represent 2 rather than 3 dimensions of the data), leave the `colour` argument out.\n\n## Layer 4\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data = penguins, mapping = aes(x=body_mass_g, y=flipper_length_mm, colour=sex)) +\n  geom_point() +\n  # changes colour palette\n  scale_colour_brewer(palette = \"Dark2\") + \n  # add breaks from 2500 to 6500 in increasing steps of 500\n  scale_x_continuous(breaks = seq(from = 2500, to = 6500, by = 500)) \n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 11 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](04-dataviz_files/figure-html/unnamed-chunk-7-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\nThe `scale_?` functions allow us to change the colour palette of the plot or the axes breaks etc. You could change the name of the axis in `scale_x_continuous()` as well or leave it for Layer 7.\n\n## Layer 5\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data = penguins, mapping = aes(x=body_mass_g, y=flipper_length_mm, colour=sex)) +\n  geom_point() +\n  scale_colour_brewer(palette = \"Dark2\") + \n  # split main plot up into different subplots by species \n  facet_wrap(~ species) \n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 11 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](04-dataviz_files/figure-html/unnamed-chunk-8-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\nHere we are faceting this plot out for the individual species.\n\n## Layer 6\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data = penguins, mapping = aes(x=body_mass_g, y=flipper_length_mm, colour=sex)) +\n  geom_point() +\n  scale_colour_brewer(palette = \"Dark2\") + \n  facet_wrap(~ species) +\n  # limits the range of the y axis\n  coord_cartesian(ylim = c(0, 250)) \n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 11 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](04-dataviz_files/figure-html/unnamed-chunk-9-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\nChanging the limits of the y axis to zoom in or out of the plot. If you wanted to the same for the x axis, you would add an argument `xlim` to the `coord_cartesian()` function.\n\n## Layer 7\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data = penguins, mapping = aes(x=body_mass_g, y=flipper_length_mm, colour=sex)) +\n  geom_point() +\n  scale_colour_brewer(palette = \"Dark2\") + \n  facet_wrap(~ species) +\n  labs(x = \"Body Mass (in g)\", # labels the x axis\n       y = \"Flipper length (in mm)\", # labels the y axis\n       colour = \"Sex\") # labels the grouping variable in the legend\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 11 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](04-dataviz_files/figure-html/unnamed-chunk-10-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\nYou can change the axes labels via the `labs()` function or include that step when modifying the scales (i.e. in the `scale_x_continuous()` function).\n\n## Layer 8\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data = penguins, mapping = aes(x=body_mass_g, y=flipper_length_mm, colour=sex)) +\n  geom_point() +\n  scale_colour_brewer(palette = \"Dark2\") + \n  facet_wrap(~ species) +\n  labs(x = \"Body Mass (in g)\", \n       y = \"Flipper length (in mm)\",\n       colour = \"Sex\") +\n  # add a theme\n  theme_classic()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 11 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](04-dataviz_files/figure-html/unnamed-chunk-11-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n`theme_classic()` is applied to change the overall appearance of the plot.\n:::\n\n::: callout-important\nYou need to stick to the first 3 layers to get your base plot. Everything else is optional meaning you don't have to use all 8 layers in a plot. And layers 4-8 can be added in a random order whereas layers 1-3 are fixed.\n:::\n\n## Activity 1: Set-up and data for today\n\n-   We are still working with the data by Pownall et al. (2023) which we aggregated in @sec-wrangling. So, open your project.\n- However, we could do with a fresh Rmd: Create a new Rmd and save it to your project folder. Name it something meaningful (e.g., \"chapter_04\", \"04_data_viz.Rmd\"). See @sec-rmd if you need some guidance. Delete everything below line 12 (keep the set-up code chunk)\n-   We aggregated the data in @sec-wrangling. If you want a fresh copy, download the data here: [data_prp_for_ch4.csv](data/data_prp_for_ch4.csv \"download\"). Make sure to place the csv file in the project folder.\n-   If you need a reminder about the data and variables, have a look at the codebook and/or @sec-download_data_ch1.\n\n\n\n## Activity 2: Load in the libraries and read in the data\n\nWe need the package `tidyverse` today, and the data `data_prp_for_ch4.csv`.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n## packages \n???\n\n## data\ndata_prp_viz <- read_csv(???)\n```\n:::\n\n\n::: {.callout-note collapse=\"true\" icon=\"false\"}\n\n## Solution\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\ndata_prp_viz <- read_csv(\"data_prp_for_ch4.csv\")\n```\n:::\n\n\n:::\n\n\n\n\n\n\n#### Re-familiarise yourself with the data structure {.unnumbered}\n\nAs we said in @sec-familiarise, it is always recommended to glimpse at the data to see how many variables and observations there are in the dataset and what kind of data type they are.\n\n::: {.callout-note collapse=\"true\"}\n## glimpse output\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nglimpse(data_prp_viz)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 89\nColumns: 28\n$ Code                                  <chr> \"Tr10\", \"Bi07\", \"SK03\", \"SM95\", …\n$ Gender                                <dbl> 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2,…\n$ Age                                   <dbl> 22, 20, 22, 26, 22, 20, 21, 21, …\n$ Ethnicity                             <chr> \"White European\", \"White British…\n$ Secondyeargrade                       <dbl> 2, 3, 1, 2, 2, 2, 2, 2, 1, 1, 1,…\n$ Opptional_mod                         <dbl> 1, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2,…\n$ Opptional_mod_1_TEXT                  <chr> \"Research methods in first year\"…\n$ Research_exp                          <dbl> 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,…\n$ Research_exp_1_TEXT                   <chr> NA, NA, NA, NA, NA, NA, NA, NA, …\n$ Plan_prereg                           <dbl> 1, 3, 1, 2, 1, 1, 3, 3, 2, 2, 2,…\n$ Pre_reg_group                         <dbl> 1, 1, 1, 2, 1, 1, 1, 2, 2, 1, 2,…\n$ SATS28_Affect_Time1_mean              <dbl> 4.000000, 3.833333, 5.000000, 5.…\n$ SATS28_CognitiveCompetence_Time1_mean <dbl> 5.166667, 5.166667, 5.666667, 4.…\n$ SATS28_Value_Time1_mean               <dbl> 6.000000, 6.666667, 5.222222, 5.…\n$ SATS28_Difficulty_Time1_mean          <dbl> 3.571429, 2.428571, 3.571429, 3.…\n$ QRPs_Acceptance_Time1_mean            <dbl> 5.909091, 6.090909, 6.545455, 5.…\n$ Time1_Understanding_OS                <dbl> 5.500000, 3.166667, 4.500000, 3.…\n$ Other_OS_behav_2                      <dbl> 1, NA, NA, NA, 1, NA, NA, 1, NA,…\n$ Other_OS_behav_4                      <dbl> 1, NA, NA, NA, NA, NA, NA, NA, N…\n$ Other_OS_behav_5                      <dbl> NA, NA, NA, NA, 1, 1, NA, NA, NA…\n$ Closely_follow                        <dbl> 2, 2, 2, NA, 3, 3, 3, NA, NA, 2,…\n$ SATS28_Affect_Time2_mean              <dbl> 3.500000, 3.166667, 4.833333, 4.…\n$ SATS28_CognitiveCompetence_Time2_mean <dbl> 4.166667, 4.666667, 6.166667, 5.…\n$ SATS28_Value_Time2_mean               <dbl> 3.000000, 6.222222, 6.000000, 4.…\n$ SATS28_Difficulty_Time2_mean          <dbl> 2.857143, 2.857143, 4.000000, 2.…\n$ QRPs_Acceptance_Time2_mean            <dbl> 5.636364, 5.454545, 6.272727, 5.…\n$ Time2_Understanding_OS                <dbl> 5.583333, 3.333333, 5.416667, 4.…\n$ Mean_Supervisor_Support               <dbl> 5.230769, 6.285714, 6.857143, 2.…\n```\n:::\n:::\n\n\n:::\n\n\nWe can see that some of the categorical data in `data_prp_viz` was read in as numeric variables which makes them continuous. This is going to haunt us big time when building the plots. We would be better off addressing these changes in the dataset before we start plotting (and potentially getting frustrated with R and data viz in general)\n\nLet’s turn a few of the categorical variables into factors.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata_prp_viz <- data_prp_viz %>% \n  mutate(Gender = factor(Gender,\n                         levels = c(2, 1, 3),\n                         labels = c(\"females\", \"males\", \"non-binary\")),\n         Secondyeargrade = factor(Secondyeargrade,\n                                  levels = c(1, 2, 3, 4, 5),\n                                  labels = c(\"≥ 70% (1st class grade)\", \"60-69% (2:1 grade)\", \"50-59% (2:2 grade)\", \"40-49% (3rd class)\", \"< 40%\")),\n         Plan_prereg = factor(Plan_prereg,\n                              levels = c(1, 3, 2),\n                              labels = c(\"Yes\", \"Unsure\", \"No\")),\n         Closely_follow = factor(Closely_follow,\n                                 levels = c(2, 3),\n                                 labels = c(\"Followed it somewhat\", \"Followed it exactly\")),\n         Research_exp = factor(Research_exp),\n         Pre_reg_group = factor(Pre_reg_group))\n```\n:::\n\n\n\n\n## Appropriate plots? {.unnumbered}\n\nNow we can think about which plot is the appropriate plot for your data. Different types of variables require different types of plots, so this comes back to how many variables are you aiming to plot and what kind of data type are they. The following part is organised by type of variable.\n\n\nToday, we will focus on plots for categorical data. Next week, we'll cover plots for continuous variables and discover which plots are appropriate if you have a mix of continuous and categorical variables\n\n\n## One categorical variable\n\n### Barchart (`geom_bar()`)\n\nLet's say we want to count some demographics. To keep it simple, we want to show gender counts. We would use a **barplot** for it. This is done with `geom_bar()` in your third layer, and because the counting is done in the background, the `aes` only requires an x value (i.e. the name of your variable).\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = Gender)) +\n  geom_bar() \n```\n\n::: {.cell-output-display}\n![Default barchart](04-dataviz_files/figure-html/fig-bc-base-1.png){#fig-bc-base fig-align='center' width=100%}\n:::\n:::\n\n\nThis is the base plot done. You can customise it by adding different layers. For example, the labels aren't super clear or it could do with a dash of colour. Click on the tabs below to see examples of what could be added and practice on your base plot in your own Rmd.\n\n\n\n::: {.panel-tabset}\n## Colour\n\nWe can change the colour by adding a fill argument in the `aes()`. If we want to modify these colours further, we would add a `scale_fill_?` argument. If you have specific colours in mind, you would use `scale_fill_manual()` or if you want to stick with pre-defined ones, like viridis, use `scale_fill_viridis_d()`\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = Gender, fill = Gender)) +\n  geom_bar() +\n  # customise colour\n  scale_fill_viridis_d()\n```\n\n::: {.cell-output-display}\n![](04-dataviz_files/figure-html/unnamed-chunk-17-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n## Axes labels & margins\n\nThe x-axis label is fine, but the categories need to be relabeled. You can achieve that with the `scale_x_discrete()` function and the argument `labels =`. But make sure you order them in the order of the labels in the dataframe.\n\nThere is also this gap between bottom of the chart and the bars which seems a bit weird. We can remove that with an `expansion()` function.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = Gender, fill = Gender)) +\n  geom_bar() +\n  scale_fill_viridis_d() +\n  # changing group labels on the breaks of the x axis\n  scale_x_discrete(labels = c(\"Female\", \"Male\", \"Non-Binary\")) + \n  scale_y_continuous(\n    # changing name of the y axis\n    name = \"Count\",\n    # remove the space below the bars (first number), but keep a tiny bit (5%) above (second number)\n    expand = expansion(mult = c(0, 0.05))\n  )\n```\n\n::: {.cell-output-display}\n![](04-dataviz_files/figure-html/unnamed-chunk-18-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n## Legend\n\nThe legend does not add any information because the labels are already provided on the x axis. We can remove the legend by adding the argument `guide = \"none\"` into the `scale_fill` function.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = Gender, fill = Gender)) +\n  geom_bar() +\n  scale_fill_viridis_d(\n    # remove the legend\n    guide = \"none\") +\n  scale_x_discrete(labels = c(\"Female\", \"Male\", \"Non-Binary\")) +\n  scale_y_continuous(\n    name = \"Count\",\n    expand = expansion(mult = c(0, 0.05))\n  )\n```\n\n::: {.cell-output-display}\n![](04-dataviz_files/figure-html/unnamed-chunk-19-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n## Themes\n\nLet's experiment with the themes. For this plot we have chosen `theme_minimal()`\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = Gender, fill = Gender)) +\n  geom_bar() +\n  scale_fill_viridis_d(\n    guide = \"none\") +\n  scale_x_discrete(labels = c(\"Female\", \"Male\", \"Non-Binary\")) +\n  scale_y_continuous(\n    name = \"Count\",\n    expand = expansion(mult = c(0, 0.05))\n  ) +\n  # pick a theme\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](04-dataviz_files/figure-html/unnamed-chunk-20-1.png){fig-align='center' width=100%}\n:::\n:::\n\n:::\n\n### Column plot (`geom_col()`)\n\nIf someone had already summarised those counts for you, you would not be able to use `geom_bar()`. In that case, you would switch to `geom_col()`.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngender_count <- data_prp_viz %>% \n  count(Gender)\n\ngender_count\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|Gender     |  n|\n|:----------|--:|\n|females    | 69|\n|males      | 17|\n|non-binary |  3|\n\n</div>\n:::\n:::\n\n\nThe mapping for `geom_col()` requires both an **x** and a **y** aesthetics. In our example, x would be our categorical variable (e.g., `Gender`), and y would be the column name that stored the values (`n`). Note how the base version has now n as an axis title (instead of count).\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(gender_count, aes(x = Gender, y = n, fill = Gender)) +\n  geom_col()\n```\n\n::: {.cell-output-display}\n![Column plot with different coloured bars](04-dataviz_files/figure-html/fig-col-1.png){#fig-col fig-align='center' width=100%}\n:::\n:::\n\n\n### Activity 3: Make the column plot pretty\n\nThe other layers to change the colour scheme, axes labels and margins, removing the legend and altering the theme require exactly the same functions as with the boxplot above. Test yourself to see if you could...\n\n-   [ ] change the colour scheme (e.g., viridis or [any other colour palettes](https://www.datanovia.com/en/blog/the-a-z-of-rcolorbrewer-palette/){target=\"_blank\"})\n-   [ ] remove the legend\n-   [ ] change the title of the x and y axes\n-   [ ] make the bars start directly on the x axis\n-   [ ] add a theme of your linking\n\n::: {.callout-tip collapse=\"true\"}\n## Possible solution code for the column plot (with a different colour palette and a different theme)\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(gender_count, aes(x = Gender, y = n, fill = Gender)) +\n  geom_col() +\n  # replaced vidiris with the brewer palette\n  scale_fill_brewer(\n    palette = \"Set1\", # try \"Set2\" or \"Dark2\" for some variety\n    guide = \"none\") + # legend removed\n  # labels of the categories changed\n  scale_x_discrete(labels = c(\"Male\", \"Female\", \"Non-Binary\")) + \n  scale_y_continuous(\n    # change y axis label\n    name = \"Count\",\n    # starts bars on x axis without any gaps but leaves some space at the top (this time 10%)\n    expand = expansion(mult = c(0, 0.1)) \n  ) +\n  # different theme\n  theme_light()\n```\n\n::: {.cell-output-display}\n![](04-dataviz_files/figure-html/unnamed-chunk-22-1.png){fig-align='center' width=100%}\n:::\n:::\n\n:::\n\n## Two categorical variables\n\nFor this task, we can look at the variable `Plan_prereg` measuring whether they planned to pre-register their undergraduate dissertation at time point 1, and `Pre_reg_group` whether they actually ended up doing a pre-registration for their undergraduate dissertations.\n\n### Stacked and percent stacked barchart\n\nOne way to display that data is by creating a **Stacked barchart** (default option) or a **Percent stacked barchart**. For both options, the subgroups are displayed on top of each other. To show the two plots next to each other for better comparison, we moved the legend to the bottom of the chart.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n## Stacked barchart\nggplot(data_prp_viz, aes(x = Plan_prereg, fill = Pre_reg_group)) +\n  geom_bar() + # no position argument added\n  theme(legend.position = \"bottom\") # move legend to the bottom\n\n## Percent stacked barchart\nggplot(data_prp_viz, aes(x = Plan_prereg, fill = Pre_reg_group)) +\n  geom_bar(position = \"fill\") + # add position argument here\n  theme(legend.position = \"bottom\") # move legend to the bottom\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![Stacked barchart (left), and Percent stacked barchart (right)](04-dataviz_files/figure-html/fig-barcharts_stacked-1.png){#fig-barcharts_stacked fig-align='center' width=100%}\n:::\n:::\n\n\nIn the **stacked barchart** (@fig-barcharts_stacked, left plot), you are able to plot participant numbers. Here we can see that the highest student number were unsure whether they wanted to pre-register their dissertation or not, followed closely by participants who answered yes. We can also see that the number of people who did not end up with a pre-registered dissertation (blue category) is the same for students who had planned to pre-register and those who did not want to pre-register. However, because `No` has quite a lower number than the other two categories, we are having a tough time seeing whether the ratio is the same across all 3 groups.\n\nIf we wanted to show that, a **Percent stacked barchart** (@fig-barcharts_stacked, right plot) would make a lot more sense. Now we would see that approximately 80% of the students who wanted to pre-register their dissertations, 50% of the students who were initially unsure, and only 33% of the students who had no pre-registration plans ended up with a ended up with a pre-registered dissertation. BUT! We would lose the information about the raw values in the sample.\n\n**It's all a trade-off and the plot you choose depends on which \"story\" of the data you want to tell.**\n\n::: callout-note\nThe position argument `position = \"stack\"` is the default. Adding this argument to the code for the left plot in @fig-barcharts_stacked would produce the same plot a leaving the argument out.\n:::\n\n### Grouped barchart\n\nA second option is a **Grouped barchart** which displays the bars next to each other. We would achieve that by changing the position argument to **\"dogde\"**. You can see the default version of the plot in the @fig-barchart_grouped on the left, and one with more layers on the right.\n\nInstead of using an existing colour palette, we changed the colours manually using hex codes. These are some of the colours Gaby used in her PhD, but you can either \n\n* create your own colour hex codes; check out [this website](https://www.hexcolortool.com/){target=\"_blank\"} OR\n* use a pre-defined colour name like \"green\" or \"purple instead. See a full list [here](https://www.datanovia.com/en/blog/awesome-list-of-657-r-color-names/){target=\"_blank\"}\n\nFeel free to explore.\n\nSince the legend title for the second plot is a bit long, we displayed the legend content across 2 rows by adding the layer `guides(fill = guide_legend(nrow = 2))` at the end.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n## Default grouped barchart\nggplot(data_prp_viz, aes(x = Plan_prereg, fill = Pre_reg_group)) +\n  geom_bar(position = \"dodge\") + # add position argument here\n  theme(legend.position = \"bottom\") # move legend to the bottom\n\n## Prettier grouped barchart\nggplot(data_prp_viz, aes(x = Plan_prereg, fill = Pre_reg_group)) +\n  geom_bar(position = \"dodge\") + # add position argument here\n  # changing labels for x, y, and fill category - alternative method\n  labs(x = \"Pre-registration planned\", y = \"Count\", fill = \"Pre-registered dissertation\") +\n  # manual colour change for values\n  scale_fill_manual(values = c('#648FFF', '#DC267F'),\n                    labels = c(\"Yes\", \"No\")) +\n  scale_y_continuous(\n    # remove the space below the bars, but keep a tiny bit (5%) above\n    expand = expansion(mult = c(0, 0.05))\n  ) +\n  # pick a theme\n  theme_classic() + \n  theme(legend.position = \"bottom\") + # need to move this part to the end otherwise the `theme_*` overrides it\n  guides(fill = guide_legend(nrow = 2)) # display legend categories across 2 rows\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![Default grouped barchart (left) and one with a few more layers added (right)](04-dataviz_files/figure-html/fig-barchart_grouped-1.png){#fig-barchart_grouped fig-align='center' width=100%}\n:::\n:::\n\n\n\n::: {.callout-tip collapse=\"true\" icon=\"false\"}\n\n## Special case: Categorical variables with missing values\n\nIf we had chosen a different categorical variable containing missing values, such as `Closely_follow` then our plots would have included those missing values by default. The code for changing the colour of the missing values columns would need to be specified slightly differently using an `na.value =` argument within the `scale_fill` function. Here is an example of a grouped barchart.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# default grouped barchart with missing values\nggplot(data_prp_viz, aes(x = Plan_prereg, fill = Closely_follow)) +\n  geom_bar(position = \"dodge\") + \n  theme(legend.position = \"bottom\") + \n  guides(fill = guide_legend(nrow = 3)) # display across 3 rows\n\n## Prettier grouped barchart with missing values\nggplot(data_prp_viz, aes(x = Plan_prereg, fill = Closely_follow)) +\n  geom_bar(position = \"dodge\") + \n  labs(x = \"Pre-registration planned\", y = \"Count\", fill = \"Pre-registration followed\") +\n  # manual colour change for values of the factor and the NA responses\n  scale_fill_manual(values = c('#648FFF', '#DC267F'), na.value = '#FFB000') +\n  scale_y_continuous(\n    expand = expansion(mult = c(0, 0.05))\n  ) +\n  theme_classic() + \n  theme(legend.position = \"bottom\") + \n  guides(fill = guide_legend(nrow = 3)) # display across 3 rows\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![Default grouped barchart (left) and one with a few more layers added (right) for a variable with missing values](04-dataviz_files/figure-html/fig-barchart_grouped_na-1.png){#fig-barchart_grouped_na fig-align='center' width=100%}\n:::\n:::\n\n\nIf you did not want those missing values to appear in the plot, you would have to do some data wrangling first to remove them. The function for that is `drop_na()`. Here we used `drop_na()` on `Closely_follow` only.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# remove NA\nprereg_plan_follow <- data_prp_viz %>% \n  select(Code, Plan_prereg, Closely_follow) %>% \n  drop_na(Closely_follow)\n```\n:::\n\n\n\n::: {.callout-note collapse=\"true\" icon=\"false\"}\n\n## check NAs have been removed\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# check NA have been removed\nprereg_plan_follow %>% \n  distinct(Plan_prereg, Closely_follow) %>% \n  arrange(Plan_prereg, Closely_follow)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|Plan_prereg |Closely_follow       |\n|:-----------|:--------------------|\n|Yes         |Followed it somewhat |\n|Yes         |Followed it exactly  |\n|Unsure      |Followed it somewhat |\n|Unsure      |Followed it exactly  |\n|No          |Followed it somewhat |\n|No          |Followed it exactly  |\n\n</div>\n:::\n:::\n\n\n:::\n\nBut keep in mind that it could misrepresent the data, e.g., giving a wrong impression about proportions. As a comparison...\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# with NA\nggplot(data_prp_viz, aes(x = Plan_prereg, fill = Closely_follow)) +\n  geom_bar(position = \"fill\") + # add position argument here\n  theme(legend.position = \"bottom\") + # move legend to the bottom\n  guides(fill = guide_legend(nrow = 2)) # display across 2 rows\n\n# without NA\nggplot(prereg_plan_follow, aes(x = Plan_prereg, fill = Closely_follow)) +\n  geom_bar(position = \"fill\") + # add position argument here\n  theme(legend.position = \"bottom\") + # move legend to the bottom\n  guides(fill = guide_legend(nrow = 2)) # display across 2 rows\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![Percent stacked barchart with (left) and without missing values (right)](04-dataviz_files/figure-html/fig-barchart_na_no_na-1.png){#fig-barchart_na_no_na fig-align='center' width=100%}\n:::\n:::\n\n\n:::\n\n\n## Activity 4: Save your plots\n\nYou can save your figures with the function `ggsave()`. It will save to your project folder.\n\nThere are two ways you can use `ggsave()`. If you don't tell `ggsave()` which plot you want to save, by **default** it will **save the last plot you created**. Our last plot was the one without `NA` from the special case scenario  (@fig-barchart_na_no_na). However, if you did not follow along with the special case scenario, your last plot will be grouped bar chart on the right from @fig-barchart_grouped.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggsave(filename = \"last_plot.png\")\n```\n:::\n\n\n\n\n::: {.callout-note collapse=\"true\"}\n\n## Our last plot saved\n\n![](images/last_plot.png)\n:::\n\n\nThe second option is to save the plot as an object and refer to the object within `ggsave()`. As an example, let's save the grouped barchart that contained missing values (@fig-barchart_grouped) as an object called `grouped_bar`.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngrouped_bar <- ggplot(data_prp_viz, aes(x = Plan_prereg, fill = Closely_follow)) +\n  geom_bar(position = \"dodge\") + \n  labs(x = \"Pre-registration planned\", y = \"Count\", fill = \"Pre-registration followed\") +\n  # manual colour change for values of the factor and the NA responses\n  scale_fill_manual(values = c('#648FFF', '#DC267F'), na.value = '#FFB000') +\n  scale_y_continuous(\n    expand = expansion(mult = c(0, 0.05))\n  ) +\n  theme_classic() + \n  theme(legend.position = \"bottom\") + \n  guides(fill = guide_legend(nrow = 3)) # display across 3 rows\n```\n:::\n\n\nThen you run the line\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggsave(filename = \"grouped_bar.png\", \n       plot = grouped_bar)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stderr}\n```\nSaving 7 x 5 in image\n```\n:::\n:::\n\n\nFilename is the name you want your png to be called, plot refers to the object name. \n\n\n::: {.callout-note collapse=\"true\"}\n\n## Our saved `grouped_bar.png` would look like this:\n\n![](images/grouped_bar.png)\n:::\n\nThat is with default settings. If you like it, keep it, but if you think it looks a bit \"stretched\", you can specify the width, the height, and the units (e.g., \"cm\", \"mm\", \"in\", \"px\" are possible). You might need to play about with the dimension before it feels right.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggsave(filename = \"grouped_bar2.png\", \n       plot = grouped_bar, \n       width = 16, height = 9, units = \"cm\")\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n::: {.callout-note collapse=\"true\"}\n\n## png with different dimensions\n\n![](images/grouped_bar2.png)\n:::\n\n\n\n## Activity 5: Your Turn\n\nPick **any single or two categorical variables** from the dataset and **choose one of the appropriate plot choices**. Start with a base plot and add other layers if you please. \n\nSave your plot and share it with us on Teams.\n\n\n\n## [Pair-coding]{style=\"color: #F39C12; text-transform: uppercase;\"} {.unnumbered}\n\nProvide a barchart, a violin-boxplot, and a scatterplot from the loneliness data and the students have to try and recreate one of those in the lab. If they are overly fast, they can do the other 2.\n\n## [Test your knowledge]{style=\"color: #F39C12; text-transform: uppercase;\"} {.unnumbered}\n\nWhich plot would you choose for\n\n\n\n\n\n\n",
    "supporting": [
      "04-dataviz_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}